{{define "title"}}Service{{end}}
{{define "heading"}}
    <div class="autocomplete">
        <h4><input class="form-control input-lg search" type=text placeholder="Search"/></h4>
        <ul class="list-group autocomplete-item">
            {{range .SvcNames}}
                <li class="list-group-item"  data-filter={{.}}><a href="registry?service={{.}}">{{.}}</a></li>
            {{end}}
        </ul>
    </div>
    {{range .SvcNames}}
        <a href="registry?service={{.}}" data-filter={{.}} class="btn btn-default btn-lg" style="margin: 5px 3px 5px 3px;">{{.}}</a>
    {{end}}
{{end}}
{{define "content"}}
    <h3>{{ if .Results }} {{with $svc := index .Results 0}}{{$svc.Name}}{{end}} {{end}}</h3>
	<hr>
	<h4>Nodes</h4>
	{{range .Results}}
	<h5>Version {{.Version}}</h5>
	<table class="table table-bordered table-striped">
		<thead>
			<th>Id</th>
			<th>Address</th>
			<th>Port</th>
			<th>Metadata</th>
		<thead>
		<tbody>
			{{range .Nodes}}
			<tr>
				<td>{{.Id}}</td>
				<td>{{.Address}}</td>
				<td>{{.Port}}</td>
				<td>{{ range $key, $value := .Metadata }}{{$key}}={{$value}} {{end}}</td>
			</tr>
			{{end}}
		</tbody>
	</table>
	{{end}}
	{{ if .Results }} 
	{{with $svc := index .Results 0}}
	{{if $svc.Endpoints}}
	<h4>Endpoints</h4>
	<hr/>
	{{end}}
	{{range $svc.Endpoints}}
		<h4>{{.Name}}</h4>
		<table class="table table-bordered">
			<tbody>
				<tr>
					<th class="col-sm-2" scope="row">Metadata</th>
					<td>{{ range $key, $value := .Metadata }}{{$key}}={{$value}} {{end}}</td>
				</tr>
				<tr>
					<th class="col-sm-2" scope="row">Request</th>
					<td><pre>{{format .Request}}</pre></td>
				</tr>
				<tr>
					<th class="col-sm-2" scope="row">Response</th>
					<td><pre>{{format .Response}}</pre></td>
				</tr>
			</tbody>
		</table>
	{{end}}
	{{end}}
	{{end}}
{{end}}
{{define "script"}}
<script type="text/javascript">
jQuery(function($, undefined) {
	var refs = $('li[data-filter]');
	$('.search').on('keyup', function() {
		var val = $.trim(this.value);
		refs.hide();
		refs.filter(function() {
			return $(this).data('filter').search(val) >= 0
		}).show();
	});
	$('.search').on('focus',function(){
	    $(".autocomplete-item").show();
	});
	$('.search').on('blur',function(evt){
	    console.log(evt)
	    setTimeout(function(){
            $(".autocomplete-item").hide();
	    },200)
    })
});
</script>
{{end}}
{{ define "style" }}
    .autocomplete{
        position:relative;
    }
    .autocomplete-item{
        display:none;
        position:absolute;
        top:100%;
        left:0;
        width: 100%;
        max-height: 206px;
        overflow-y: scroll;
        border-bottom: 1px solid #ddd;
    }
    .autocomplete-item li:hover{
        background:#f0f0f0;
    }
    .autocomplete-item a{
        width: 100%;
        color: black;
        display: block;
    }
    .autocomplete-item a:hover{
        text-decoration: none;
    }
{{end}}